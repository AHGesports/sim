# Workflow Version Control - UI/UX Specification

## Overview

A Git-like version control system for workflows where Global workflows serve as "main" branches and Agent workflows are forks that can pull updates, with visual merge conflict resolution.

---

## Core Philosophy

### Don't Rebuild Git - Use It

Instead of implementing Git-like features from scratch, we use **actual Git** under the hood:

| Layer | Technology | Purpose |
|-------|------------|---------|
| Storage | **isomorphic-git** | Pure JS Git implementation, runs in browser & Node |
| Repository | PostgreSQL + File System | Store Git repos per workflow family |
| Graph Visualization | **ReactFlow** (already used) | Custom nodes for commits |
| Diff/Merge | **diff-match-patch** or **jsdiff** | JSON workflow diffing |
| Conflict UI | Existing copilot review pattern | Accept/reject changes |

### Why Real Git?

1. **Battle-tested** - Handles all edge cases
2. **Familiar model** - Users know Git concepts
3. **Standard format** - `.git` directories, standard tools work
4. **Future-proof** - CLI access, integrations, backups

---

## 1. Conceptual Model

### 1.1 Mapping Concepts

| Git Concept | Workflow Concept |
|-------------|------------------|
| Repository | Workflow Family (global + all forks) |
| `main` branch | Global Workflow |
| Feature branch | Agent's Fork |
| Commit | Saved workflow state |
| Merge | Pull changes from global |
| Conflict | Block-level differences |

### 1.2 Branch Structure

```
main (Global)
â”‚
â”œâ”€â”€ commit: "Initial workflow"
â”œâ”€â”€ commit: "Add scraping block"
â”œâ”€â”€ commit: "Fix prompt"
â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ agent/agent-1
â”‚                                  â”‚
â”‚                                  â”œâ”€â”€ commit: "Fork from main"
â”‚                                  â”œâ”€â”€ commit: "Add agent filter"
â”‚                                  â””â”€â”€ commit: "Custom prompts"
â”‚
â”œâ”€â”€ commit: "Improve error handling"  â† Agent 1 can pull this
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ agent/agent-2
                                   â”‚
                                   â”œâ”€â”€ commit: "Fork from main"
                                   â””â”€â”€ commit: "Different config"
```

---

## 2. Version History Panel

### 2.1 Panel Location

The version history lives in a **collapsible right panel** (like existing panels):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Toolbar]                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚                 â”‚
â”‚                                                           â”‚  VERSION        â”‚
â”‚                    WORKFLOW CANVAS                        â”‚  HISTORY        â”‚
â”‚                                                           â”‚                 â”‚
â”‚                                                           â”‚  [Graph]        â”‚
â”‚                                                           â”‚                 â”‚
â”‚                                                           â”‚  [Commits]      â”‚
â”‚                                                           â”‚                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Panel: Editor / Console / Copilot / Versions]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Panel Toggle

Add to existing panel tabs:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Editor]  [Console]  [Copilot]  [Versions]                     â”‚
â”‚                                  â•â•â•â•â•â•â•â•â•â•                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Branch Graph Visualization

### 3.1 Compact Graph View (Sidebar Style)

Inspired by GitHub/GitLab commit graphs:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VERSION HISTORY                                    [âŸ³] [âš™ï¸]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  BRANCH: agent/agent-1 â–¾                    [â†“ Pull from main]  â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚     â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ main (Global)    â”‚
â”‚     â”‚                                                           â”‚
â”‚     â—  [abc123] Add scraping block                             â”‚
â”‚     â”‚  Alice â€¢ 2 hours ago                                      â”‚
â”‚     â”‚                                                           â”‚
â”‚     â”‚  â—‹â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ agent/agent-1   â”‚
â”‚     â”‚  â”‚                                                        â”‚
â”‚     â—  â”‚  [def456] Fork from main                              â”‚
â”‚     â”‚  â”‚  System â€¢ 1 hour ago                                   â”‚
â”‚     â”‚  â”‚                                                        â”‚
â”‚     â”‚  â—  [ghi789] Add custom filter               â† YOU ARE HERE
â”‚     â”‚  â”‚  You â€¢ 30 min ago                                      â”‚
â”‚     â”‚  â”‚                                                        â”‚
â”‚     â—  â”‚  [jkl012] Improve error handling          â† 1 NEW     â”‚
â”‚     â”‚  â”‚  Alice â€¢ 15 min ago                                    â”‚
â”‚     â”‚  â”‚                                                        â”‚
â”‚     â–¼  â–¼                                                        â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ main has 1 new commit                                       â”‚
â”‚                                                                 â”‚
â”‚  [â†“ Pull Changes]  [View Diff]                                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Graph Legend

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LEGEND                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â—  Commit on current branch        â”‚
â”‚  â—‹  Commit on other branch          â”‚
â”‚  â”‚  Branch line                     â”‚
â”‚  â”œâ”€ Fork point                      â”‚
â”‚  â†“  Merge direction                 â”‚
â”‚                                     â”‚
â”‚  ğŸ”µ main (Global)                   â”‚
â”‚  ğŸŸ¢ agent/agent-1 (current)         â”‚
â”‚  ğŸŸ£ agent/agent-2                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 Full Graph View (Modal)

For complex histories, open expanded view:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Workflow History: LinkedIn Scraper                                    [Ã—]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  [All Branches â–¾]  [Date Range â–¾]  [Author â–¾]           ğŸ” Search commits  â”‚
â”‚                                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â”‚         main              agent-1           agent-2           agent-3       â”‚
â”‚           â”‚                  â”‚                 â”‚                 â”‚          â”‚
â”‚           â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚           â”‚ Initial          â”‚                 â”‚                 â”‚          â”‚
â”‚           â”‚                  â”‚                 â”‚                 â”‚          â”‚
â”‚           â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚                 â”‚          â”‚
â”‚           â”‚ Add blocks       â”œâ”€â”€â”€â”€â”€â—‹           â”‚                 â”‚          â”‚
â”‚           â”‚                  â”‚     â”‚Fork       â”‚                 â”‚          â”‚
â”‚           â”‚                  â”‚     â”‚           â”‚                 â”‚          â”‚
â”‚           â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚          â”‚
â”‚           â”‚ Fix prompt       â”‚     â”‚           â”œâ”€â”€â”€â”€â”€â—‹           â”‚          â”‚
â”‚           â”‚                  â”‚     â”‚           â”‚     â”‚Fork       â”‚          â”‚
â”‚           â”‚                  â”‚     â—           â”‚     â”‚           â”‚          â”‚
â”‚           â”‚                  â”‚     â”‚Custom     â”‚     â”‚           â”‚          â”‚
â”‚           â”‚                  â”‚     â”‚filter     â”‚     â—           â”‚          â”‚
â”‚           â”‚                  â”‚     â”‚           â”‚     â”‚Config     â”‚          â”‚
â”‚           â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚           â”‚ Error handling   â”‚     â”‚           â”‚     â”‚           â”œâ”€â”€â”€â”€â”€â—‹    â”‚
â”‚           â”‚                  â”‚     â”‚           â”‚     â”‚           â”‚     â”‚    â”‚
â”‚           â”‚                  â”‚     â— â† â”€ â”€ â”€ â”€â”‚â”€ â”€ â”€â”‚â”€ â”€ â”€ â”€ â”€ â”€â”‚â”€ â”€ â”˜    â”‚
â”‚           â”‚                  â”‚     â”‚Pull      â”‚     â”‚           â”‚          â”‚
â”‚           â”‚                  â”‚     â—          â”‚     â”‚           â”‚          â”‚
â”‚           â”‚                  â”‚     â”‚Merged    â”‚     â”‚           â”‚          â”‚
â”‚           â–¼                  â–¼     â–¼          â–¼     â–¼           â–¼          â”‚
â”‚                                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â”‚  COMMIT DETAILS                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [jkl012] Improve error handling                                       â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚ Author: Alice                                                         â”‚ â”‚
â”‚  â”‚ Date: Jan 2, 2025 14:23                                              â”‚ â”‚
â”‚  â”‚ Branch: main                                                          â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚ Changes:                                                              â”‚ â”‚
â”‚  â”‚ â€¢ Modified: Web Scraper block (error handling)                       â”‚ â”‚
â”‚  â”‚ â€¢ Modified: Output block (retry logic)                               â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚ [View Changes]  [Restore to This]  [Create Branch From]              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Commit Flow

### 4.1 Auto-Commit Triggers

Commits are created automatically on:
- Save (Cmd+S)
- After copilot applies changes
- Before switching branches/pulling
- Every 5 minutes of activity (background)

### 4.2 Commit Message Generation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¾ Save Changes                                           [Ã—]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Commit Message                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Update Web Scraper prompt and add retry logic           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           [âœ¨ Auto-generate]                    â”‚
â”‚                                                                 â”‚
â”‚  Changes in this commit:                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âœ Modified: Web Scraper                                 â”‚   â”‚
â”‚  â”‚   â€¢ prompt: "Scrape..." â†’ "Scrape with retry..."        â”‚   â”‚
â”‚  â”‚   â€¢ retryCount: 0 â†’ 3                                   â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚ + Added: Error Handler                                  â”‚   â”‚
â”‚  â”‚   â€¢ New block connected to Web Scraper                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚                                    [Cancel]  [Save & Commit]    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 Quick Save (No Dialog)

Keyboard shortcut `Cmd+S` saves with auto-generated message:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  âœ“ Saved                                    [View in History]   â”‚
â”‚    "Update Web Scraper prompt"                                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†‘
                     Toast notification (3s)
```

---

## 5. Fork Flow

### 5.1 Fork Button (Global Workflow)

In Global workflow sidebar:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŒ LinkedIn Scraper                                            â”‚
â”‚                                                                 â”‚
â”‚  [Run Agents â–¾]  [Fork to Agent â–¾]                     [â–¶ Run]  â”‚
â”‚                           â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                           â”‚
â”‚  FORK TO AGENT                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                           â”‚
â”‚  Select target agent:                     â”‚
â”‚                                           â”‚
â”‚  â—‹ Agent 1                                â”‚
â”‚  â—‹ Agent 2                                â”‚
â”‚  â—‹ Agent 3 - Production                   â”‚
â”‚  â— Agent 4 - Testing                      â”‚
â”‚                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                           â”‚
â”‚  Fork name (optional):                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ LinkedIn Scraper                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                           â”‚
â”‚  â˜‘ Track changes from global              â”‚
â”‚    (enables pull updates)                 â”‚
â”‚                                           â”‚
â”‚              [Cancel]  [Create Fork]      â”‚
â”‚                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Fork Indicator (Agent Workflow)

When viewing a forked workflow:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¤ LinkedIn Scraper                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ”— Forked from: ğŸŒ LinkedIn Scraper          [Go to â†—]  â”‚   â”‚
â”‚  â”‚    Last synced: 2 hours ago  â€¢  1 update available      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  [â†“ Pull Updates]                                      [â–¶ Run]  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Pull Flow

### 6.1 Pull Updates Button

When global has new commits:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VERSION HISTORY                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  âš ï¸ main has 2 new commits                                      â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [jkl012] Improve error handling                         â”‚   â”‚
â”‚  â”‚ Alice â€¢ 15 min ago                                       â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚ [mno345] Add rate limiting                              â”‚   â”‚
â”‚  â”‚ Bob â€¢ 5 min ago                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  [View Full Diff]  [â†“ Pull Updates]                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 Pre-Pull Diff View

Before pulling, show what will change:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pull Changes from main                                                [Ã—]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Incoming changes from ğŸŒ main (2 commits)                                  â”‚
â”‚                                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â”‚  BLOCKS                                                                     â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âœ Web Scraper                                              MODIFIED  â”‚ â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚   retryCount:                                                         â”‚ â”‚
â”‚  â”‚   - 0                                                                 â”‚ â”‚
â”‚  â”‚   + 3                                                                 â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚   errorHandling:                                                      â”‚ â”‚
â”‚  â”‚   + "graceful"                                                        â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ + Rate Limiter                                                  NEW  â”‚ â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚   New block will be added between:                                    â”‚ â”‚
â”‚  â”‚   [Web Scraper] â†’ [Rate Limiter] â†’ [Output]                          â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â”‚  âš ï¸ Potential conflicts detected in 1 block                                 â”‚
â”‚     You have local changes to: Web Scraper                                  â”‚
â”‚                                                                             â”‚
â”‚                                    [Cancel]  [Pull & Auto-Merge]            â”‚
â”‚                                              [Pull & Review Conflicts]      â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Merge Conflict Resolution

### 7.1 Conflict Detection

When both global and agent modified the same block:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ Merge Conflicts                                                    [Ã—]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  1 conflict needs your attention                                            â”‚
â”‚                                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â”‚  CONFLICT 1 of 1: Web Scraper                                               â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ ğŸŒ INCOMING (main)          â”‚ ğŸ‘¤ YOURS (agent-1)          â”‚             â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚  â”‚                             â”‚                             â”‚             â”‚
â”‚  â”‚ prompt:                     â”‚ prompt:                     â”‚             â”‚
â”‚  â”‚ "Scrape LinkedIn profiles   â”‚ "Scrape profiles from      â”‚             â”‚
â”‚  â”‚  with retry logic and       â”‚  @global.authors and       â”‚  â† CONFLICT â”‚
â”‚  â”‚  error handling"            â”‚  apply custom filter"      â”‚             â”‚
â”‚  â”‚                             â”‚                             â”‚             â”‚
â”‚  â”‚ retryCount: 3               â”‚ retryCount: 0              â”‚  â† CONFLICT â”‚
â”‚  â”‚                             â”‚                             â”‚             â”‚
â”‚  â”‚ errorHandling: "graceful"   â”‚ (not set)                  â”‚  â† NEW      â”‚
â”‚  â”‚                             â”‚                             â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  RESOLUTION OPTIONS                                                         â”‚
â”‚                                                                             â”‚
â”‚  â—‹ Accept Incoming (main)     - Use global version, discard local          â”‚
â”‚  â—‹ Keep Yours (agent-1)       - Keep local version, ignore global          â”‚
â”‚  â— Merge Manually             - Combine changes (recommended)               â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  MERGED RESULT                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ prompt:                                                               â”‚ â”‚
â”‚  â”‚ "Scrape profiles from @global.authors with retry logic,              â”‚ â”‚
â”‚  â”‚  apply custom filter and error handling"                             â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚ retryCount: 3     â† from main                                        â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚ errorHandling: "graceful"     â† from main (new field)                â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚ customFilter: true     â† keeping yours                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  [Edit Merged Result]                                                       â”‚
â”‚                                                                             â”‚
â”‚                                    [Cancel Pull]  [Apply Resolution]        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 Visual Conflict on Canvas

Highlight conflicting blocks on the workflow canvas:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                          WORKFLOW CANVAS                                    â”‚
â”‚                                                                             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚             â”‚      â”‚ âš ï¸ Web Scraper              â”‚      â”‚         â”‚  â”‚
â”‚     â”‚   Trigger   â”‚â”€â”€â”€â”€â”€â–¶â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚â”€â”€â”€â”€â”€â–¶â”‚ Output  â”‚  â”‚
â”‚     â”‚             â”‚      â”‚ CONFLICT - Click to resolve â”‚      â”‚         â”‚  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ [Accept Theirs] [Keep Mine] â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â”‚ click                                â”‚
â”‚                                      â–¼                                      â”‚
â”‚                          Opens conflict resolution modal                    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 Reusing Copilot Review Pattern

Leverage existing accept/reject UI from copilot changes:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Web Scraper - Merge Conflict                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  prompt                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚   â”‚
â”‚  â”‚ â–“â–“ Scrape profiles from @global.authors               â–“â–“â”‚   â”‚
â”‚  â”‚ â–‘â–‘ with retry logic and error handling                â–‘â–‘â”‚   â”‚
â”‚  â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  Legend: â–“â–“ Your changes  â–‘â–‘ Incoming changes                  â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  [âœ“ Accept All Incoming]  [âœ“ Keep All Mine]  [âœï¸ Edit Manually] â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  FIELD-BY-FIELD RESOLUTION                                      â”‚
â”‚                                                                 â”‚
â”‚  retryCount                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ ğŸŒ Incoming: 3         â”‚ ğŸ‘¤ Yours: 0            â”‚           â”‚
â”‚  â”‚ [âœ“ Accept]             â”‚ [âœ“ Accept]             â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚  errorHandling                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ ğŸŒ Incoming: "graceful"â”‚ ğŸ‘¤ Yours: (none)       â”‚           â”‚
â”‚  â”‚ [âœ“ Accept]    â† NEW    â”‚ [Skip]                 â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. Graph Implementation

### 8.1 Using ReactFlow for Commit Graph

Since you already use ReactFlow, create custom nodes:

```typescript
// Commit node types for ReactFlow
type CommitNode = {
  id: string;
  type: 'commit';
  data: {
    hash: string;
    message: string;
    author: string;
    timestamp: Date;
    branch: string;
    isCurrent: boolean;
    isConflict: boolean;
  };
  position: { x: number; y: number };
};

type BranchLabelNode = {
  id: string;
  type: 'branchLabel';
  data: {
    name: string;
    color: string;
    isGlobal: boolean;
  };
  position: { x: number; y: number };
};
```

### 8.2 Graph Layout Algorithm

Use vertical layout with branches as columns:

```
Column 0        Column 1        Column 2
(main)          (agent-1)       (agent-2)
   â”‚                â”‚               â”‚
   â—                â”‚               â”‚
   â”‚                â”‚               â”‚
   â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‹               â”‚
   â”‚                â”‚               â”‚
   â”‚                â—               â”‚
   â”‚                â”‚               â”‚
   â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‹
   â”‚                â”‚               â”‚
   â”‚                â”‚               â—
   â–¼                â–¼               â–¼
```

### 8.3 Alternative: gitgraph.js Integration

For simpler implementation, use **@gitgraph/react**:

```typescript
import { Gitgraph, templateExtend, TemplateName } from "@gitgraph/react";

const template = templateExtend(TemplateName.Metro, {
  branch: {
    lineWidth: 2,
    spacing: 50,
  },
  commit: {
    spacing: 60,
    dot: { size: 8 },
    message: { displayAuthor: false },
  },
});

function WorkflowHistory({ commits, branches }) {
  return (
    <Gitgraph options={{ template }}>
      {(gitgraph) => {
        const main = gitgraph.branch("main");
        // Build graph from commits...
      }}
    </Gitgraph>
  );
}
```

---

## 9. Data Model

### 9.1 Workflow Version Schema

```typescript
interface WorkflowVersion {
  id: string;
  workflowId: string;

  // Git-like fields
  commitHash: string;
  parentHash: string | null;
  branch: string;  // "main" | "agent/{agentId}"

  // Metadata
  message: string;
  author: {
    id: string;
    name: string;
    type: 'user' | 'copilot' | 'system';
  };
  createdAt: Date;

  // Snapshot
  workflowState: WorkflowJSON;  // Full workflow as JSON

  // Tracking
  isHead: boolean;  // Current version for this branch
  forkPoint: string | null;  // Commit where this branch forked
}

interface WorkflowBranch {
  id: string;
  workflowFamilyId: string;
  name: string;  // "main" | "agent/agent-1"
  headCommit: string;

  // For agent branches
  agentId: string | null;
  tracksMain: boolean;  // Whether to show pull updates
  lastSyncedCommit: string | null;
}
```

### 9.2 Using isomorphic-git

```typescript
import * as git from 'isomorphic-git';
import http from 'isomorphic-git/http/web';
import { IndexedDBBackend } from '@isomorphic-git/lightning-fs';

// Initialize repo for workflow family
async function initWorkflowRepo(workflowId: string) {
  const fs = new LightningFS(`workflow-${workflowId}`);

  await git.init({ fs, dir: '/' });

  // Save initial workflow as JSON file
  await fs.promises.writeFile(
    '/workflow.json',
    JSON.stringify(workflowState)
  );

  await git.add({ fs, dir: '/', filepath: 'workflow.json' });
  await git.commit({
    fs,
    dir: '/',
    message: 'Initial workflow',
    author: { name: 'System', email: 'system@sim.ai' }
  });
}
```

---

## 10. URL Structure

```
/workspace/{agentId}/w/{workflowId}                    â†’ View workflow
/workspace/{agentId}/w/{workflowId}/history            â†’ Version history
/workspace/{agentId}/w/{workflowId}/history/{commit}   â†’ View specific version
/workspace/{agentId}/w/{workflowId}/compare/{a}...{b}  â†’ Compare versions
/workspace/{agentId}/w/{workflowId}/merge              â†’ Merge conflict UI

/global/w/{workflowId}                                 â†’ Global workflow
/global/w/{workflowId}/branches                        â†’ All agent forks
```

---

## 11. Implementation Phases

### Phase 1: Foundation (Week 1-2)
- [ ] Set up isomorphic-git with IndexedDB storage
- [ ] Create WorkflowVersion and WorkflowBranch tables
- [ ] Implement commit on save
- [ ] Basic commit history list (no graph yet)

### Phase 2: Graph Visualization (Week 3-4)
- [ ] Create ReactFlow commit nodes
- [ ] Implement graph layout algorithm
- [ ] Add branch labels and legend
- [ ] Build compact sidebar graph view

### Phase 3: Fork & Pull (Week 5-6)
- [ ] Fork workflow to agent (create branch)
- [ ] Track fork point and main head
- [ ] Detect when main has new commits
- [ ] Pre-pull diff view

### Phase 4: Merge & Conflicts (Week 7-8)
- [ ] Implement 3-way merge for workflow JSON
- [ ] Detect block-level conflicts
- [ ] Build conflict resolution UI
- [ ] Integrate with existing copilot review pattern

### Phase 5: Polish (Week 9)
- [ ] Full graph modal view
- [ ] Search/filter commits
- [ ] Restore to previous version
- [ ] Branch comparison view

---

## 12. Reusing Existing Versioning Infrastructure

### 12.1 What Already Exists

The deployment system already has a robust versioning foundation:

| Component | Location | Current Use | Git-like Reuse |
|-----------|----------|-------------|----------------|
| **Database Table** | `packages/db/schema.ts` â†’ `workflowDeploymentVersion` | Stores deployment snapshots | Store commit history |
| **Versions UI** | `deploy-modal/components/versions.tsx` | List versions with rename/restore | Commit history list |
| **Change Detection** | `lib/workflows/comparison/compare.ts` â†’ `hasWorkflowChanged()` | Detect unsaved changes | Merge conflict detection |
| **Revert API** | `api/workflows/[id]/deployments/[version]/revert/route.ts` | Restore previous version | Checkout commit |
| **State Snapshots** | `state` JSON column in `workflowDeploymentVersion` | Full workflow state | Commit content |

### 12.2 Existing Database Schema

```typescript
// packages/db/schema.ts - ALREADY EXISTS
export const workflowDeploymentVersion = pgTable('workflow_deployment_version', {
  id: text('id').primaryKey(),
  workflowId: text('workflow_id').notNull().references(() => workflow.id, { onDelete: 'cascade' }),
  version: integer('version').notNull(),
  name: text('name'),                    // Can become commit message
  state: json('state').notNull(),        // Full workflow snapshot âœ“
  isActive: boolean('is_active').notNull().default(false),
  createdAt: timestamp('created_at').notNull().defaultNow(),
  createdBy: text('created_by'),
})
```

### 12.3 Extending for Git-like Features

**Option A: Extend Existing Table** (Recommended for MVP)

```typescript
// Add new columns to workflowDeploymentVersion
parentVersionId: text('parent_version_id'),  // Git parent pointer
branchName: text('branch_name'),             // "main" | "agent/{agentId}"
forkSourceId: text('fork_source_id'),        // Original workflow for forks
commitHash: text('commit_hash'),             // Short hash for display
```

**Option B: New Dedicated Table** (For full Git semantics)

```typescript
export const workflowCommit = pgTable('workflow_commit', {
  id: text('id').primaryKey(),
  workflowFamilyId: text('workflow_family_id').notNull(),
  parentId: text('parent_id'),
  branchId: text('branch_id').notNull(),
  commitHash: text('commit_hash').notNull(),
  message: text('message').notNull(),
  state: json('state').notNull(),
  authorId: text('author_id'),
  authorType: text('author_type'),  // 'user' | 'copilot' | 'system'
  createdAt: timestamp('created_at').notNull().defaultNow(),
})

export const workflowBranch = pgTable('workflow_branch', {
  id: text('id').primaryKey(),
  workflowFamilyId: text('workflow_family_id').notNull(),
  name: text('name').notNull(),             // "main" | "agent/agent-1"
  headCommitId: text('head_commit_id'),
  forkPointCommitId: text('fork_point_commit_id'),
  agentId: text('agent_id'),                // NULL for main
  tracksMain: boolean('tracks_main').default(true),
  lastSyncedCommitId: text('last_synced_commit_id'),
})
```

### 12.4 Reusable Code Patterns

**Change Detection (compare.ts)**
```typescript
// Already compares workflow states - REUSE for conflict detection
import { hasWorkflowChanged, compareWorkflows } from '@/lib/workflows/comparison/compare'

// Use to detect merge conflicts:
const baseToMain = compareWorkflows(baseState, mainState)
const baseToAgent = compareWorkflows(baseState, agentState)
const conflicts = findConflictingBlocks(baseToMain, baseToAgent)
```

**Version List UI (versions.tsx)**
```typescript
// Existing pattern - adapt for commit history
// Current: lists deployment versions with actions
// New: list commits with branch indicators

// Reusable patterns:
// - Fetch versions hook pattern
// - Version item row with actions
// - Promote/rename/load actions â†’ checkout/merge/revert
```

**Revert API Pattern**
```typescript
// Current: POST /api/workflows/[id]/deployments/[version]/revert
// Loads state from version table, saves to normalized tables

// Reuse for: checkout commit
// POST /api/workflows/[id]/commits/[commitId]/checkout
```

### 12.5 Migration Strategy

1. **Keep deployment versions** for production deployments (unchanged)
2. **Add commit system** alongside for development version control
3. **Link them**: Each deployment creates a tagged commit

```
Development Commits          Deployments
       â”‚                         â”‚
       â—  "Fix prompt"           â”‚
       â”‚                         â”‚
       â—  "Add retry" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ v1.0.0 (deployed)
       â”‚                         â”‚
       â—  "Improve filter"       â”‚
       â”‚                         â”‚
       â—  "Rate limiting" â”€â”€â”€â”€â”€â”€â–¶ v1.1.0 (deployed)
       â”‚                         â”‚
       â–¼                         â–¼
```

---

## 13. Key Libraries

| Library | Purpose | Install |
|---------|---------|---------|
| **isomorphic-git** | Git operations in JS | `bun add isomorphic-git` |
| **@isomorphic-git/lightning-fs** | IndexedDB filesystem | `bun add @isomorphic-git/lightning-fs` |
| **diff-match-patch** | Text diffing | `bun add diff-match-patch` |
| **@gitgraph/react** | Git graph viz (optional) | `bun add @gitgraph/react` |
| **reactflow** | Custom graph (already have) | Already installed |

---

## Appendix: Visual Language

### Colors

```css
--branch-main: #3B82F6;      /* Blue - Global/main */
--branch-agent: #10B981;     /* Green - Agent branches */
--commit-current: #FBBF24;   /* Yellow - Current HEAD */
--conflict: #EF4444;         /* Red - Conflicts */
--incoming: #8B5CF6;         /* Purple - Incoming changes */
--yours: #10B981;            /* Green - Your changes */
```

### Icons

```
â—  Commit (filled)
â—‹  Commit on other branch (outline)
â—  Merge commit
âš ï¸  Conflict
â†“  Pull available
â†—  Link to source
ğŸ”—  Fork indicator
```

